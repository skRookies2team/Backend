# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Build Commands

```bash
# Build the project
./gradlew build

# Clean build artifacts
./gradlew clean

# Run the application
./gradlew bootRun

# Run tests
./gradlew test

# Run a specific test class
./gradlew test --tests ClassName
```

## Project Overview

Interactive story game player backend built with Spring Boot 3.2 + JPA + MariaDB.

**Main entry point**: `src/main/java/com/story/game/StoryGameApplication.java`

## Architecture

```
com.story.game/
├── config/         # WebConfig (CORS)
├── controller/     # REST API endpoints
├── dto/            # Data transfer objects (matches Python AI output)
├── entity/         # JPA entities (GameSession, StoryData)
├── repository/     # Data access layer
└── service/        # Game logic (GameService)
```

### Core Flow

1. Python AI generates story JSON → uploaded via `/api/game/stories`
2. Player starts game → creates GameSession with initial gauges
3. Player makes choices → updates tags, finds next node
4. Leaf node reached → evaluates episode ending, applies gauge changes
5. All episodes complete → evaluates final ending

### Key Components

- **GameSession**: Tracks player state (current node, gauges, accumulated tags, visited nodes)
- **StoryData**: Stores the complete story JSON from Python AI
- **GameService**: Core game logic including node navigation, condition evaluation

## REST API

```
POST /api/game/start              - Start new game (body: {storyDataId})
GET  /api/game/{sessionId}        - Get current state
POST /api/game/{sessionId}/choice - Make choice (body: {choiceIndex})
GET  /api/game/stories            - List all stories
POST /api/game/stories            - Upload story JSON
POST /api/game/stories/generate   - Generate story via AI server
GET  /api/game/ai/health          - Check AI server health
```

## Configuration

Database connection in `src/main/resources/application.yml`:
- Default DB: `story_game` on localhost:3306
- Set `DB_PASSWORD` env variable or update password in yml
- Set `AI_SERVER_URL` env variable (default: http://localhost:8000)

## Python AI Integration

This backend plays stories generated by the Python AI engine at:
https://github.com/skRookies2team/AI/tree/feature/kwak

The JSON structure from Python maps to DTOs in `com.story.game.dto`.
